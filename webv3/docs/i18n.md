# Internationalization (i18n) Setup for APISIX Dashboard v3

This document describes the internationalization setup for APISIX Dashboard v3 using `next-intl`.

## Overview

The APISIX Dashboard v3 supports three locales:
- **en-US** (English - United States) - Default locale
- **zh-CN** (Chinese - Simplified)
- **tr-TR** (Turkish)

## File Structure

```
webv3/
├── i18n/
│   └── request.ts              # next-intl configuration
├── messages/
│   ├── en-US.json             # English translations
│   ├── zh-CN.json             # Chinese translations
│   └── tr-TR.json             # Turkish translations
├── middleware.ts               # Next.js middleware for locale detection
└── app/
    └── [locale]/              # Locale-specific routes
        ├── layout.tsx         # Root layout with i18n provider
        └── page.tsx           # Home page
```

## Configuration Files

### 1. i18n/request.ts

This file configures next-intl with supported locales and the default locale:

```typescript
import { getRequestConfig } from 'next-intl/server';

export const locales = ['en-US', 'zh-CN', 'tr-TR'] as const;
export type Locale = (typeof locales)[number];
export const defaultLocale: Locale = 'en-US';

export default getRequestConfig(async ({ locale }) => {
  return {
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

### 2. middleware.ts

This middleware handles locale detection and URL routing:

```typescript
import createMiddleware from 'next-intl/middleware';
import { locales, defaultLocale } from './i18n/request';

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: 'always',
  localeDetection: true,
});

export const config = {
  matcher: ['/', '/(en-US|zh-CN|tr-TR)/:path*'],
};
```

## Translation File Structure

Translation files are organized in a hierarchical JSON structure for better maintainability:

```json
{
  "navBar": { ... },
  "layout": { ... },
  "menu": { ... },
  "component": {
    "global": { ... },
    "status": { ... },
    "notification": { ... },
    "steps": { ... },
    "user": { ... }
  },
  "page": {
    "route": { ... },
    "ssl": { ... },
    "upstream": { ... },
    "service": { ... },
    "consumer": { ... },
    "plugin": { ... },
    "proto": { ... },
    "serverInfo": { ... },
    "setting": { ... }
  },
  "plugin": { ... },
  "upstream": { ... }
}
```

## Usage in Components

### Server Components

```typescript
import { useTranslations } from 'next-intl';

export default function ServerComponent() {
  const t = useTranslations();

  return (
    <div>
      <h1>{t('menu.routes')}</h1>
      <p>{t('page.route.description')}</p>
    </div>
  );
}
```

### Client Components

```typescript
'use client';

import { useTranslations } from 'next-intl';

export default function ClientComponent() {
  const t = useTranslations();

  return (
    <button>{t('component.global.create')}</button>
  );
}
```

### Scoped Translations

For better organization, you can scope translations to a specific namespace:

```typescript
import { useTranslations } from 'next-intl';

export default function RouteList() {
  const t = useTranslations('page.route');

  return (
    <div>
      <h1>{t('list')}</h1>
      <p>{t('description')}</p>
      <button>{t('create')}</button>
    </div>
  );
}
```

### Accessing Nested Values

```typescript
const t = useTranslations();

// Access nested values using dot notation
t('component.global.name')          // "Name"
t('page.route.name.required')       // "Please enter the route name"
t('upstream.type.roundrobin')       // "Round Robin"
```

## Locale Switching

To switch between locales, update the URL path:

```typescript
import Link from 'next/link';
import { useLocale } from 'next-intl';

export default function LocaleSwitcher() {
  const locale = useLocale();

  return (
    <div>
      <Link href="/en-US/routes">English</Link>
      <Link href="/zh-CN/routes">中文</Link>
      <Link href="/tr-TR/routes">Türkçe</Link>
    </div>
  );
}
```

Or programmatically:

```typescript
'use client';

import { useRouter, usePathname } from 'next/navigation';
import { useLocale } from 'next-intl';

export default function LocaleSwitcher() {
  const router = useRouter();
  const pathname = usePathname();
  const currentLocale = useLocale();

  const switchLocale = (newLocale: string) => {
    // Replace current locale in pathname
    const newPathname = pathname.replace(`/${currentLocale}`, `/${newLocale}`);
    router.push(newPathname);
  };

  return (
    <select onChange={(e) => switchLocale(e.target.value)} value={currentLocale}>
      <option value="en-US">English</option>
      <option value="zh-CN">中文</option>
      <option value="tr-TR">Türkçe</option>
    </select>
  );
}
```

## Adding New Translations

1. **Add the key to all locale files** (`messages/en-US.json`, `messages/zh-CN.json`, `messages/tr-TR.json`):

```json
{
  "page": {
    "newFeature": {
      "title": "New Feature",
      "description": "Description of the new feature"
    }
  }
}
```

2. **Use the translation in your component**:

```typescript
const t = useTranslations('page.newFeature');
return <h1>{t('title')}</h1>;
```

## Translation Key Conventions

Follow these naming conventions for consistency:

- Use camelCase for keys: `userName`, `createButton`
- Group related translations under common namespaces: `page.route.*`, `component.global.*`
- Use descriptive names: `confirmDelete` instead of `confirm`
- For form fields: `{field}.label`, `{field}.placeholder`, `{field}.required`, `{field}.error`

## Migration from Web (v2)

The translations have been migrated from the existing web (v2) implementation:

- **Source**: `/web/src/locales/{locale}/`
- **Target**: `/webv3/messages/{locale}.json`

Key changes:
1. Converted from TypeScript modules to JSON files
2. Reorganized flat structure into hierarchical structure
3. Simplified key naming (removed prefix like `page.route.` in favor of nested objects)

## Best Practices

1. **Always provide all translations**: Ensure every key exists in all locale files to avoid fallback issues
2. **Use TypeScript for type safety**: Consider generating types from translation files
3. **Keep translations close to components**: Use scoped translations with `useTranslations('namespace')`
4. **Avoid hardcoded strings**: Always use translation keys, even for English
5. **Test with different locales**: Verify UI layout works with longer/shorter text in different languages

## Resources

- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [Next.js Internationalization](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [Original APISIX Dashboard i18n](https://github.com/apache/apisix-dashboard/tree/master/web/src/locales)

## Troubleshooting

### Translations not loading

1. Check that the locale is in the `locales` array in `i18n/request.ts`
2. Verify the JSON file exists: `messages/{locale}.json`
3. Check for JSON syntax errors in translation files

### Wrong locale being used

1. Verify the middleware matcher in `middleware.ts`
2. Check URL structure: should be `/{locale}/path`
3. Clear browser cookies and localStorage

### Missing translation warnings

1. Ensure the key exists in the JSON file
2. Check for typos in the translation key
3. Verify nested structure matches your key path

## License

Licensed under the Apache License 2.0. See LICENSE file for details.
